<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Online - Duduxindev</title>
    <!-- Carregando estilos -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Tela de Início -->
    <div id="start-screen" class="screen active">
        <div class="logo-container">
            <h1 class="game-logo">UNO</h1>
            <p class="game-subtitle">Jogue com seus amigos em qualquer lugar!</p>
        </div>
        <div class="menu-container">
            <button id="play-local-btn" class="menu-btn">
                <span class="icon">Jogar no Dispositivo</span>
            </button>
            <button id="play-online-btn" class="menu-btn">
                <span class="icon">Jogar Online</span>
            </button>
            <button id="options-btn" class="menu-btn">
                <span class="icon">Opções</span>
            </button>
            <button id="rules-btn" class="menu-btn">
                <span class="icon">Regras</span>
            </button>
        </div>
        <div class="version-info">
            v1.2.0 - Atualizado em 11/04/2025 17:11:13<br>
            Desenvolvido por Duduxindev
        </div>
    </div>

    <!-- Tela de Configuração de Jogo Local -->
    <div id="local-game-screen" class="screen">
        <h2>Jogar no Dispositivo</h2>
        <div class="form-container">
            <div class="mode-selection-container">
                <button class="mode-card selected" data-mode="normal">
                    <div class="mode-icon">N</div>
                    <h3>Modo Normal</h3>
                    <p>Regras clássicas do UNO</p>
                </button>
                <button class="mode-card" data-mode="wild">
                    <div class="mode-icon">W</div>
                    <h3>Modo Wild</h3>
                    <p>Mais cartas especiais</p>
                </button>
                <button class="mode-card" data-mode="no-mercy">
                    <div class="mode-icon">NM</div>
                    <h3>No Mercy</h3>
                    <p>Empilhe +2/+4 sem limites</p>
                </button>
                <button class="mode-card" data-mode="seven-zero">
                    <div class="mode-icon">7-0</div>
                    <h3>Seven-Zero</h3>
                    <p>Regras especiais para 7 e 0</p>
                </button>
            </div>
            
            <div class="config-section">
                <h3>Personalização (para qualquer modo)</h3>
                <div class="custom-rules-container">
                    <div class="custom-rule">
                        <input type="checkbox" id="stacking" class="rule-checkbox">
                        <label for="stacking">Empilhamento de +2/+4</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="jump-in" class="rule-checkbox">
                        <label for="jump-in">Jump-In (Carta idêntica interrompe turno)</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="force-play" class="rule-checkbox">
                        <label for="force-play">Jogar carta comprada quando possível</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="seven-trade" class="rule-checkbox">
                        <label for="seven-trade">Sete = Trocar mãos</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="zero-rotate" class="rule-checkbox">
                        <label for="zero-rotate">Zero = Rotacionar mãos</label>
                    </div>
                </div>
            </div>
            
            <div class="config-section">
                <h3>Número de Jogadores</h3>
                <div class="player-count-slider">
                    <input type="range" id="player-count" min="2" max="8" value="4" class="slider">
                    <span id="player-count-value">4 Jogadores</span>
                </div>
            </div>
            
            <div class="buttons-row">
                <button id="start-local-game-btn" class="primary-btn">Iniciar Jogo</button>
                <button id="back-from-local" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Opções Online -->
    <div id="online-options-screen" class="screen">
        <h2>Jogar Online</h2>
        <div class="online-options">
            <button id="create-room-option" class="online-option">
                <div class="option-icon">CR</div>
                <h3>Criar Sala</h3>
                <p>Crie uma nova sala e convide seus amigos</p>
            </button>
            <button id="join-room-option" class="online-option">
                <div class="option-icon">ES</div>
                <h3>Entrar em Sala</h3>
                <p>Entre em uma sala existente com o código</p>
            </button>
        </div>
        <div class="info-box">
            <p><strong>Como funciona:</strong> Esta versão permite jogar entre dispositivos diferentes! O anfitrião cria a sala e compartilha o código com os amigos. Todos podem jogar de seus próprios dispositivos.</p>
        </div>
        <button id="back-from-online-options" class="secondary-btn">Voltar</button>
    </div>

    <!-- Tela de Criar Sala -->
    <div id="create-room-screen" class="screen">
        <h2>Criar Nova Sala</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="host-name">Seu Nome:</label>
                <input type="text" id="host-name" class="form-input" placeholder="Digite seu nome">
            </div>
            <div class="form-group">
                <label for="room-mode">Modo de Jogo:</label>
                <select id="room-mode" class="form-select">
                    <option value="normal">Normal</option>
                    <option value="wild">Wild</option>
                    <option value="no-mercy">No Mercy</option>
                    <option value="seven-zero">Seven-Zero</option>
                </select>
            </div>
            <div class="form-group">
                <label for="max-players">Número de Jogadores:</label>
                <select id="max-players" class="form-select">
                    <option value="2">2 Jogadores</option>
                    <option value="3">3 Jogadores</option>
                    <option value="4" selected>4 Jogadores</option>
                    <option value="6">6 Jogadores</option>
                    <option value="8">8 Jogadores</option>
                </select>
            </div>
            <div class="form-group">
                <h3>Personalização</h3>
                <div class="custom-rules-container">
                    <div class="custom-rule">
                        <input type="checkbox" id="room-stacking" class="rule-checkbox">
                        <label for="room-stacking">Empilhamento de +2/+4</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-jump-in" class="rule-checkbox">
                        <label for="room-jump-in">Jump-In (Carta idêntica interrompe turno)</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-force-play" class="rule-checkbox">
                        <label for="room-force-play">Jogar carta comprada quando possível</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-seven-trade" class="rule-checkbox">
                        <label for="room-seven-trade">Sete = Trocar mãos</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-zero-rotate" class="rule-checkbox">
                        <label for="room-zero-rotate">Zero = Rotacionar mãos</label>
                    </div>
                </div>
            </div>
            <div class="buttons-row">
                <button id="create-room-btn" class="primary-btn">Criar Sala</button>
                <button id="back-from-create" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Entrar em Sala -->
    <div id="join-room-screen" class="screen">
        <h2>Entrar em Sala</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="player-name">Seu Nome:</label>
                <input type="text" id="player-name" class="form-input" placeholder="Digite seu nome">
            </div>
            <div class="form-group">
                <label for="room-code">Código da Sala:</label>
                <input type="text" id="room-code" class="form-input" placeholder="Digite o código de 4 letras">
                <p class="form-hint">Peça ao anfitrião o código da sala.</p>
            </div>
            <div class="buttons-row">
                <button id="join-room-btn" class="primary-btn">Entrar na Sala</button>
                <button id="back-from-join" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Sala de Espera -->
    <div id="waiting-room-screen" class="screen">
        <h2>Sala de Espera</h2>
        <div class="waiting-room-layout">
            <div class="waiting-room-left">
                <div class="room-info">
                    <div class="room-code-box">
                        <h3>Código da Sala:</h3>
                        <div class="code-display">
                            <span id="room-code-display">XXXX</span>
                            <button id="copy-code-btn" class="icon-btn" title="Copiar código">Copiar</button>
                        </div>
                        <p class="share-text">Compartilhe este código com seus amigos para que eles possam entrar na sala em seus dispositivos.</p>
                    </div>
                    <div class="room-details">
                        <div class="detail-item">
                            <span class="detail-label">Modo:</span>
                            <span id="room-mode-display" class="detail-value">Normal</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Jogadores:</span>
                            <span id="room-players-count" class="detail-value">1/4</span>
                        </div>
                    </div>
                </div>
                <div class="players-container">
                    <h3>Jogadores</h3>
                    <ul id="players-list" class="players-list">
                        <!-- Jogadores serão adicionados dinamicamente -->
                    </ul>
                </div>
                <div class="waiting-message" id="waiting-message">
                    <p>Aguardando jogadores entrarem na sala...</p>
                </div>
                <div class="buttons-row">
                    <button id="start-game-btn" class="primary-btn">Iniciar Jogo</button>
                    <button id="leave-room-btn" class="secondary-btn">Sair da Sala</button>
                </div>
            </div>
            
            <!-- Nova seção de chat na sala de espera -->
            <div class="waiting-room-right">
                <div class="chat-container">
                    <h3>Chat da Sala</h3>
                    <div id="waiting-chat-messages" class="chat-messages">
                        <!-- Mensagens serão adicionadas dinamicamente -->
                        <div class="system-message">Bem-vindo ao chat! Converse com outros jogadores aqui.</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="waiting-chat-input" class="chat-input" placeholder="Digite sua mensagem...">
                        <button id="waiting-chat-send" class="chat-send-btn">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Jogo -->
    <div id="game-screen" class="screen">
        <div class="game-layout">
            <div class="game-main">
                <div class="game-header">
                    <div class="game-info">
                        <span id="current-player">Vez de: Jogador 1</span>
                        <span id="cards-left">Cartas no monte: 87</span>
                    </div>
                    <div class="game-actions">
                        <button id="uno-btn" class="action-btn uno-btn">UNO!</button>
                        <button id="menu-btn" class="action-btn menu-btn">Menu</button>
                    </div>
                </div>
                
                <div class="game-table">
                    <div class="opponents-container" id="opponents-container">
                        <!-- Oponentes serão adicionados dinamicamente -->
                    </div>
                    
                    <div class="center-area">
                        <div class="game-status-indicator" id="game-status-indicator">
                            <div class="status-text">Seu turno!</div>
                            <div class="timer-bar"><div class="timer-progress"></div></div>
                        </div>
                        
                        <div class="deck-area">
                            <div id="draw-pile" class="card-pile draw-pile">
                                <!-- Pilha de compra -->
                            </div>
                            <div id="discard-pile" class="card-pile discard-pile">
                                <!-- Pilha de descarte -->
                            </div>
                        </div>
                        <div id="game-messages" class="game-messages">
                            <!-- Mensagens do jogo -->
                        </div>
                    </div>
                    
                    <div class="player-hand-container">
                        <div class="player-info">
                            <div class="player-info-left">
                                <span id="player-name-display">Você</span>
                                <span id="card-count">7 cartas</span>
                            </div>
                            <div id="cards-preview" class="cards-preview">
                                <!-- Preview das cartas jogáveis -->
                            </div>
                        </div>
                        <div id="player-hand" class="player-hand">
                            <!-- As cartas do jogador serão adicionadas aqui -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nova seção de chat no jogo -->
            <div class="game-sidebar">
                <div class="chat-container">
                    <h3>Chat</h3>
                    <div id="game-chat-messages" class="chat-messages">
                        <!-- Mensagens serão adicionadas dinamicamente -->
                        <div class="system-message">Use "!uno" para chamar UNO pelo chat!</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="game-chat-input" class="chat-input" placeholder="Digite sua mensagem...">
                        <button id="game-chat-send" class="chat-send-btn">Enviar</button>
                    </div>
                </div>
                
                <div class="game-stats">
                    <h3>Estatísticas</h3>
                    <div id="game-stats-content" class="game-stats-content">
                        <!-- Estatísticas serão adicionadas dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
        
        <div id="color-selector" class="color-selector hidden">
            <h3>Escolha uma cor:</h3>
            <div class="color-options">
                <button class="color-btn red" data-color="red"></button>
                <button class="color-btn blue" data-color="blue"></button>
                <button class="color-btn green" data-color="green"></button>
                <button class="color-btn yellow" data-color="yellow"></button>
            </div>
        </div>
    </div>

    <!-- Tela de Regras -->
    <div id="rules-screen" class="screen">
        <h2>Regras do UNO</h2>
        <div class="rules-content">
            <h3>Regras Básicas</h3>
            <p>O objetivo do UNO é ser o primeiro jogador a se livrar de todas as cartas.</p>
            <p>Cada jogador recebe 7 cartas no início. O restante forma o monte de compras.</p>
            <p>A primeira carta do monte é virada para iniciar a pilha de descarte.</p>
            <p>Os jogadores devem jogar uma carta que combine com a cor, número ou símbolo da carta no topo da pilha de descarte.</p>
            <p>Se não tiver uma carta compatível, o jogador deve comprar uma carta do monte. Se a carta comprada for jogável, ela pode ser jogada imediatamente.</p>
            <p>Quando um jogador ficar com apenas uma carta, deve dizer "UNO!". Se não disser e for pego por outro jogador, deve comprar 2 cartas.</p>
            
            <h3>Cartas Especiais</h3>
            <ul>
                <li><strong>Pular (Skip):</strong> O próximo jogador perde a vez.</li>
                <li><strong>Inverter (Reverse):</strong> Inverte a direção do jogo.</li>
                <li><strong>+2:</strong> O próximo jogador compra 2 cartas e perde a vez.</li>
                <li><strong>Curinga (Wild):</strong> Permite escolher a cor que continuará o jogo.</li>
                <li><strong>Curinga +4 (Wild Draw Four):</strong> Permite escolher a cor e o próximo jogador compra 4 cartas e perde a vez.</li>
            </ul>
            
            <h3>Modos de Jogo</h3>
            <ul>
                <li><strong>Normal:</strong> Regras padrão do UNO.</li>
                <li><strong>Wild:</strong> Mais cartas especiais no baralho.</li>
                <li><strong>No Mercy:</strong> Sem limitações para cartas +2 e +4, possibilitando grandes sequências.</li>
                <li><strong>Seven-Zero:</strong> A carta 7 faz trocar mãos com outro jogador e a carta 0 faz todos os jogadores passarem suas mãos.</li>
            </ul>
            
            <h3>Regras Personalizáveis</h3>
            <ul>
                <li><strong>Empilhamento:</strong> Cartas +2 e +4 podem ser empilhadas, acumulando o efeito.</li>
                <li><strong>Jump-In:</strong> Se você tem uma carta idêntica à do topo da pilha de descarte, pode jogá-la a qualquer momento.</li>
                <li><strong>Força de Jogo:</strong> Se comprar uma carta jogável, deve jogá-la imediatamente.</li>
            </ul>
        </div>
        <button id="back-from-rules" class="secondary-btn">Voltar</button>
    </div>

    <!-- Tela de Opções -->
    <div id="options-screen" class="screen">
        <h2>Opções</h2>
        <div class="options-container">
            <div class="option-group">
                <h3>Sons</h3>
                <div class="option-item">
                    <label for="sound-effects">Efeitos Sonoros</label>
                    <label class="switch">
                        <input type="checkbox" id="sound-effects" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="background-music">Música de Fundo</label>
                    <label class="switch">
                        <input type="checkbox" id="background-music" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="option-group">
                <h3>Visual</h3>
                <div class="option-item">
                    <label for="card-animation">Animações de Cartas</label>
                    <label class="switch">
                        <input type="checkbox" id="card-animation" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="dark-mode">Modo Escuro</label>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="option-group">
                <h3>Jogabilidade</h3>
                <div class="option-item">
                    <label for="auto-uno">UNO Automático</label>
                    <label class="switch">
                        <input type="checkbox" id="auto-uno">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="turn-timer">Temporizador de Turnos</label>
                    <label class="switch">
                        <input type="checkbox" id="turn-timer" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="show-playable">Destacar Cartas Jogáveis</label>
                    <label class="switch">
                        <input type="checkbox" id="show-playable" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
        <button id="back-from-options" class="secondary-btn">Voltar</button>
    </div>

    <!-- Notificação Toast -->
    <div id="toast" class="toast"></div>

    <!-- Firebase Configuration and App Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/cards.js"></script>
    <script src="js/player.js"></script>
    <script src="js/modes.js"></script>
    <script src="js/room.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Script para inicialização - Garante funcionamento dos botões -->
    <script>
        console.log("Inicializando aplicação UNO em: " + new Date().toISOString());
        
        // Verificar se todos os scripts foram carregados corretamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado completamente");
            
            // Verificar se as principais classes estão definidas
            const classesCheck = [
                {name: 'RoomManager', obj: window.RoomManager},
                {name: 'UnoCard', obj: window.UnoCard}, 
                {name: 'UnoDeck', obj: window.UnoDeck},
                {name: 'Player', obj: window.Player},
                {name: 'GameMode', obj: window.GameMode},
                {name: 'UnoGame', obj: window.UnoGame},
                {name: 'GameStorage', obj: window.GameStorage},
                {name: 'ChatManager', obj: window.ChatManager}
            ];
            
            const missingClasses = classesCheck.filter(c => typeof c.obj !== 'function');
            
            if (missingClasses.length > 0) {
                console.error("ERRO: As seguintes classes não foram carregadas:", 
                    missingClasses.map(c => c.name).join(', '));
            } else {
                console.log("Todas as classes necessárias foram carregadas com sucesso");
            }
            
            // Verificar Firebase
            if (typeof firebase === 'undefined') {
                console.error("ERRO: Firebase SDK não foi carregado corretamente");
            } else {
                console.log("Firebase SDK carregado com sucesso");
            }
            
            // Verificar elementos essenciais da UI
            const uiElements = [
                {name: 'Tela inicial', elem: document.getElementById('start-screen')},
                {name: 'Tela do jogo local', elem: document.getElementById('local-game-screen')},
                {name: 'Tela de opções online', elem: document.getElementById('online-options-screen')}
            ];
            
            const missingElements = uiElements.filter(e => !e.elem);
            
            if (missingElements.length > 0) {
                console.error("ERRO: Os seguintes elementos UI não foram encontrados:", 
                    missingElements.map(e => e.name).join(', '));
            } else {
                console.log("Todos os elementos essenciais da UI foram encontrados");
            }
            
            // Verificar botões principais
            const mainButtons = [
                'play-local-btn', 'play-online-btn', 'options-btn', 'rules-btn'
            ];
            
            mainButtons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    console.log(`Botão '${id}' encontrado, adicionando evento de teste`);
                    // Adicionar evento de backup para garantir funcionamento
                    btn.addEventListener('click', function() {
                        console.log(`Clique no botão '${id}' detectado`);
                        
                        // Mapeamento de redirecionamento para cada botão
                        const redirectMap = {
                            'play-local-btn': 'local-game-screen',
                            'play-online-btn': 'online-options-screen',
                            'options-btn': 'options-screen',
                            'rules-btn': 'rules-screen'
                        };
                        
                        // Redirecionar para a tela correta
                        if (redirectMap[id]) {
                            // Esconder todas as telas
                            document.querySelectorAll('.screen').forEach(screen => {
                                screen.classList.remove('active');
                            });
                            
                            // Mostrar a tela de destino
                            const targetScreen = document.getElementById(redirectMap[id]);
                            if (targetScreen) {
                                targetScreen.classList.add('active');
                                console.log(`Navegando para a tela: ${redirectMap[id]}`);
                            } else {
                                console.error(`Tela de destino não encontrada: ${redirectMap[id]}`);
                            }
                        }
                    });
                } else {
                    console.error(`ERRO: Botão '${id}' não foi encontrado`);
                }
            });
        });
    </script>
</body>
</html>