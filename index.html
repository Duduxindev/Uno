<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Online - Duduxindev</title>
    
    <!-- Estilos principais -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cards-fixed.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/uno-master-fix.css">
    <link rel="stylesheet" href="css/emergency-fix.css">
    <link rel="stylesheet" href="css/cards-visibility-fix.css">
    <link rel="stylesheet" href="css/enhanced-cards.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Scripts de detec√ß√£o e corre√ß√£o de erros de banco de dados -->
    <script src="js/database-error-fix.js"></script>
    
    <!-- Firebase SDK Modular (vers√£o 9) -->
    <script type="module">
        // Import do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove, update, get } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-analytics.js";
        
        // Configura√ß√£o atualizada
        const firebaseConfig = {
            apiKey: "AIzaSyBlYzl1Kzd5pY0gZYRghsrGkbCfLm6iTqk",
            authDomain: "uno-game-duduxindev.firebaseapp.com",
            databaseURL: "https://uno-game-duduxindev-default-rtdb.firebaseio.com",
            projectId: "uno-game-duduxindev",
            storageBucket: "uno-game-duduxindev.firebasestorage.app",
            messagingSenderId: "1020680045987",
            appId: "1:1020680045987:web:f8e762882f180fd6b9c616",
            measurementId: "G-HYKE1R16G5"
        };
        
        try {
            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            const auth = getAuth(app);
            const analytics = getAnalytics(app);
            
            // Expor para scripts n√£o modulares
            window.firebaseApp = app;
            window.firebaseDb = db;
            window.firebaseAuth = auth;
            window.firebaseAnalytics = analytics;
            
            console.log("‚úÖ Firebase Modular inicializado com sucesso!");
        } catch (error) {
            console.error("‚ùå Erro ao inicializar Firebase Modular:", error);
            document.dispatchEvent(new CustomEvent('firebase-init-failed'));
        }
    </script>
    
    <!-- Firebase compat para compatibilidade com c√≥digo existente -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-analytics-compat.js"></script>
    
    <script>
        try {
            // Inicializar API de compatibilidade
            firebase.initializeApp({
                apiKey: "AIzaSyBlYzl1Kzd5pY0gZYRghsrGkbCfLm6iTqk",
                authDomain: "uno-game-duduxindev.firebaseapp.com",
                databaseURL: "https://uno-game-duduxindev-default-rtdb.firebaseio.com",
                projectId: "uno-game-duduxindev",
                storageBucket: "uno-game-duduxindev.firebasestorage.app",
                messagingSenderId: "1020680045987",
                appId: "1:1020680045987:web:f8e762882f180fd6b9c616",
                measurementId: "G-HYKE1R16G5"
            });
            
            console.log("‚úÖ Firebase Compat inicializado com sucesso!");
        } catch (error) {
            console.error("‚ùå Erro ao inicializar Firebase Compat:", error);
            document.dispatchEvent(new CustomEvent('firebase-compat-init-failed'));
        }
    </script>
</head>
<body>
    <script>
    console.log("üö® Aplicando corre√ß√£o emergencial: 2025-04-14 14:48:21");
    console.log("üîÑ Vers√£o do sistema: 2.1.0");
    console.log("üë§ Usu√°rio atual: Duduxindev");
    </script>
    
    <!-- Tela de In√≠cio -->
    <div id="start-screen" class="screen active">
        <div class="logo-container">
            <h1 class="game-logo">UNO</h1>
            <p class="game-subtitle">Jogue com seus amigos em qualquer lugar!</p>
        </div>
        <div class="menu-container">
            <button id="play-local-btn" class="menu-btn">
                <span class="icon">Jogar no Dispositivo</span>
            </button>
            <button id="play-online-btn" class="menu-btn">
                <span class="icon">Jogar Online</span>
            </button>
            <button id="options-btn" class="menu-btn">
                <span class="icon">Op√ß√µes</span>
            </button>
            <button id="rules-btn" class="menu-btn">
                <span class="icon">Regras</span>
            </button>
        </div>
        <div class="version-info">
            v2.1.0 - Atualizado em 2025-04-14 14:48:21<br>
            Desenvolvido por Duduxindev
        </div>
    </div>

    <!-- Tela de Configura√ß√£o de Jogo Local -->
    <div id="local-game-screen" class="screen">
        <h2>Jogar no Dispositivo</h2>
        <div class="form-container">
            <div class="mode-selection">
                <h3>Selecione o Modo de Jogo</h3>
                <div class="modes-container">
                    <div class="mode-card selected" data-mode="normal">
                        <div class="mode-icon">N</div>
                        <h4>Normal</h4>
                        <p>Regras cl√°ssicas do UNO</p>
                    </div>
                    
                    <div class="mode-card" data-mode="wild">
                        <div class="mode-icon">W</div>
                        <h4>Wild</h4>
                        <p>Mais cartas especiais</p>
                    </div>
                    
                    <div class="mode-card" data-mode="no-mercy">
                        <div class="mode-icon">NM</div>
                        <h4>No Mercy</h4>
                        <p>Empilhe +2/+4 sem limites</p>
                    </div>
                    
                    <div class="mode-card" data-mode="seven-zero">
                        <div class="mode-icon">7-0</div>
                        <h4>Seven-Zero</h4>
                        <p>Regras para 7 e 0</p>
                    </div>
                    
                    <div class="mode-card" data-mode="extreme">
                        <div class="mode-icon">EX</div>
                        <h4>Extreme</h4>
                        <p>Todas as regras especiais</p>
                    </div>
                    
                    <div class="mode-card" data-mode="speed">
                        <div class="mode-icon">SP</div>
                        <h4>Speed</h4>
                        <p>Turnos de 15 segundos</p>
                    </div>
                    
                    <div class="mode-card" data-mode="chaos">
                        <div class="mode-icon">CH</div>
                        <h4>Chaos</h4>
                        <p>Regras imprevis√≠veis</p>
                    </div>
                    
                    <div class="mode-card" data-mode="action-only">
                        <div class="mode-icon">AO</div>
                        <h4>Action Only</h4>
                        <p>Sem cartas num√©ricas</p>
                    </div>

                    <!-- Novos modos de jogo ser√£o adicionados por JavaScript -->
                </div>
                <div class="mode-description" id="mode-description">
                    Modo cl√°ssico com regras originais do UNO.
                </div>
            </div>
            
            <div class="config-section">
                <h3>Personaliza√ß√£o (para qualquer modo)</h3>
                <div class="custom-rules-container">
                    <div class="custom-rule">
                        <input type="checkbox" id="stacking" class="rule-checkbox">
                        <label for="stacking">Empilhamento de +2/+4</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="jump-in" class="rule-checkbox">
                        <label for="jump-in">Jump-In (Carta id√™ntica interrompe turno)</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="force-play" class="rule-checkbox">
                        <label for="force-play">Jogar carta comprada quando poss√≠vel</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="seven-trade" class="rule-checkbox">
                        <label for="seven-trade">Sete = Trocar m√£os</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="zero-rotate" class="rule-checkbox">
                        <label for="zero-rotate">Zero = Rotacionar m√£os</label>
                    </div>
                </div>
            </div>
            
            <div class="config-section">
                <h3>N√∫mero de Jogadores</h3>
                <div class="player-count-slider">
                    <input type="range" id="player-count" min="2" max="8" value="4" class="slider">
                    <span id="player-count-value">4 Jogadores</span>
                </div>
            </div>
            
            <div class="buttons-row">
                <button id="start-local-game-btn" class="primary-btn">Iniciar Jogo</button>
                <button id="back-from-local" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Op√ß√µes Online -->
    <div id="online-options-screen" class="screen">
        <h2>Jogar Online</h2>
        <div class="online-options">
            <button id="create-room-option" class="online-option">
                <div class="option-icon">CR</div>
                <h3>Criar Sala</h3>
                <p>Crie uma nova sala e convide seus amigos</p>
            </button>
            <button id="join-room-option" class="online-option">
                <div class="option-icon">ES</div>
                <h3>Entrar em Sala</h3>
                <p>Entre em uma sala existente com o c√≥digo</p>
            </button>
        </div>
        <div class="info-box">
            <p><strong>Como funciona:</strong> Esta vers√£o permite jogar entre dispositivos diferentes! O anfitri√£o cria a sala e compartilha o c√≥digo com os amigos. Todos podem jogar de seus dispositivos em tempo real.</p>
            <p><strong>Novidade:</strong> Chance de obter a carta lend√°ria "99" com vit√≥ria instant√¢nea!</p>
        </div>
        <button id="back-from-online-options" class="secondary-btn">Voltar</button>
    </div>

    <!-- Tela de Criar Sala -->
    <div id="create-room-screen" class="screen">
        <h2>Criar Nova Sala</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="host-name">Seu Nome:</label>
                <input type="text" id="host-name" class="form-input" placeholder="Digite seu nome">
            </div>
            <div class="form-group">
                <label for="room-mode">Modo de Jogo:</label>
                <select id="room-mode" class="form-select">
                    <option value="normal">Normal - Regras cl√°ssicas</option>
                    <option value="wild">Wild - Mais cartas especiais</option>
                    <option value="no-mercy">No Mercy - Empilhamento sem limites</option>
                    <option value="seven-zero">Seven-Zero - Troca de m√£os</option>
                    <option value="extreme">Extreme - Cartas especiais e regras ca√≥ticas</option>
                    <option value="speed">Speed - Jogo r√°pido, turnos de 15s</option>
                    <option value="chaos">Chaos - Regras imprevis√≠veis</option>
                    <option value="action-only">Action Only - Sem cartas num√©ricas</option>
                    <!-- Novos modos de jogo ser√£o adicionados por JavaScript -->
                </select>
                <div class="mode-description" id="room-mode-description">
                    Modo cl√°ssico com regras originais do UNO.
                </div>
            </div>
            <div class="form-group">
                <label for="max-players">N√∫mero de Jogadores:</label>
                <select id="max-players" class="form-select">
                    <option value="2">2 Jogadores</option>
                    <option value="3">3 Jogadores</option>
                    <option value="4" selected>4 Jogadores</option>
                    <option value="6">6 Jogadores</option>
                    <option value="8">8 Jogadores</option>
                </select>
            </div>
            <div class="form-group">
                <h3>Personaliza√ß√£o</h3>
                <div class="custom-rules-container">
                    <div class="custom-rule">
                        <input type="checkbox" id="room-stacking" class="rule-checkbox">
                        <label for="room-stacking">Empilhamento de +2/+4</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-jump-in" class="rule-checkbox">
                        <label for="room-jump-in">Jump-In (Carta id√™ntica interrompe turno)</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-force-play" class="rule-checkbox">
                        <label for="room-force-play">Jogar carta comprada quando poss√≠vel</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-seven-trade" class="rule-checkbox">
                        <label for="room-seven-trade">Sete = Trocar m√£os</label>
                    </div>
                    <div class="custom-rule">
                        <input type="checkbox" id="room-zero-rotate" class="rule-checkbox">
                        <label for="room-zero-rotate">Zero = Rotacionar m√£os</label>
                    </div>
                </div>
            </div>
            <div class="buttons-row">
                <button id="create-room-btn" class="primary-btn">Criar Sala</button>
                <button id="back-from-create" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Entrar em Sala -->
    <div id="join-room-screen" class="screen">
        <h2>Entrar em Sala</h2>
        <div class="form-container">
            <div class="form-group">
                <label for="player-name">Seu Nome:</label>
                <input type="text" id="player-name" class="form-input" placeholder="Digite seu nome">
            </div>
            <div class="form-group">
                <label for="room-code">C√≥digo da Sala:</label>
                <input type="text" id="room-code" class="form-input" placeholder="Digite o c√≥digo de 4 letras">
                <p class="form-hint">Pe√ßa ao anfitri√£o o c√≥digo da sala.</p>
            </div>
            <div class="buttons-row">
                <button id="join-room-btn" class="primary-btn">Entrar na Sala</button>
                <button id="back-from-join" class="secondary-btn">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Tela de Sala de Espera -->
    <div id="waiting-room-screen" class="screen">
        <h2>Sala de Espera</h2>
        <div class="waiting-room-layout">
            <div class="waiting-room-left">
                <div class="room-info">
                    <div class="room-code-box">
                        <h3>C√≥digo da Sala:</h3>
                        <div class="code-display">
                            <span id="room-code-display">XXXX</span>
                            <button id="copy-code-btn" class="icon-btn" title="Copiar c√≥digo">Copiar</button>
                        </div>
                        <p class="share-text">Compartilhe este c√≥digo com seus amigos para que eles possam entrar na sala em seus dispositivos.</p>
                    </div>
                    <div class="room-details">
                        <div class="detail-item">
                            <span class="detail-label">Modo:</span>
                            <span id="room-mode-display" class="detail-value">Normal</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Jogadores:</span>
                            <span id="room-players-count" class="detail-value">1/4</span>
                        </div>
                    </div>
                </div>
                <div class="players-container">
                    <h3>Jogadores</h3>
                    <ul id="players-list" class="players-list">
                        <!-- Jogadores ser√£o adicionados dinamicamente -->
                    </ul>
                </div>
                <div class="waiting-message" id="waiting-message">
                    <p>Aguardando jogadores entrarem na sala...</p>
                </div>
                <div class="buttons-row">
                    <button id="start-game-btn" class="primary-btn pulse-button">Iniciar Jogo</button>
                    <button id="leave-room-btn" class="secondary-btn">Sair da Sala</button>
                </div>
            </div>
            
            <!-- Se√ß√£o de chat na sala de espera -->
            <div class="waiting-room-right">
                <div class="chat-container">
                    <h3>Chat da Sala</h3>
                    <div id="waiting-chat-messages" class="chat-messages">
                        <!-- Mensagens ser√£o adicionadas dinamicamente -->
                        <div class="system-message">Bem-vindo ao chat! Converse com outros jogadores aqui.</div>
                        <div class="system-message">Novidade: Voc√™ pode encontrar a lend√°ria carta 99!</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="waiting-chat-input" class="chat-input" placeholder="Digite sua mensagem...">
                        <button id="waiting-chat-send" class="chat-send-btn">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Jogo -->
    <div id="game-screen" class="screen">
        <div class="game-layout">
            <div class="game-main">
                <div class="game-header">
                    <div class="game-info">
                        <span id="current-player">Vez de: Jogador 1</span>
                        <span id="cards-left">Cartas no monte: 87</span>
                    </div>
                    <div class="game-actions">
                        <button id="uno-btn" class="action-btn uno-btn">UNO!</button>
                        <button id="menu-btn" class="action-btn menu-btn">Menu</button>
                    </div>
                </div>
                
                <div class="game-table">
                    <div class="opponents-container" id="opponents-container">
                        <!-- Oponentes ser√£o adicionados dinamicamente -->
                    </div>
                    
                    <div class="center-area">
                        <div class="game-status-indicator" id="game-status-indicator">
                            <div class="status-text">Seu turno!</div>
                            <div class="timer-bar"><div class="timer-progress"></div></div>
                        </div>
                        
                        <div class="deck-area">
                            <div id="draw-pile" class="card-pile draw-pile">
                                <!-- Pilha de compra -->
                            </div>
                            <div id="discard-pile" class="card-pile discard-pile">
                                <!-- Pilha de descarte -->
                            </div>
                        </div>
                        <div id="game-messages" class="game-messages">
                            <!-- Mensagens do jogo -->
                        </div>
                    </div>
                    
                    <div class="player-hand-container">
                        <div class="player-info">
                            <div class="player-info-left">
                                <span id="player-name-display">Voc√™</span>
                                <span id="card-count">7 cartas</span>
                            </div>
                            <div id="cards-preview" class="cards-preview">
                                <!-- Preview das cartas jog√°veis -->
                            </div>
                        </div>
                        <div id="player-hand" class="player-hand">
                            <!-- As cartas do jogador ser√£o adicionadas aqui -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Se√ß√£o de chat no jogo -->
            <div class="game-sidebar">
                <div class="chat-container">
                    <h3>Chat</h3>
                    <div id="game-chat-messages" class="chat-messages">
                        <!-- Mensagens ser√£o adicionadas dinamicamente -->
                        <div class="system-message">Use "!uno" para chamar UNO pelo chat!</div>
                        <div class="system-message">Busque a lend√°ria carta 99 para vit√≥ria instant√¢nea!</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="game-chat-input" class="chat-input" placeholder="Digite sua mensagem...">
                        <button id="game-chat-send" class="chat-send-btn">Enviar</button>
                    </div>
                </div>
                
                <div class="game-stats">
                    <h3>Estat√≠sticas</h3>
                    <div id="game-stats-content" class="game-stats-content">
                        <!-- Estat√≠sticas ser√£o adicionadas dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
        
        <div id="color-selector" class="color-selector hidden">
            <h3>Escolha uma cor:</h3>
            <div class="color-options">
                <button class="color-btn red" data-color="red"></button>
                <button class="color-btn blue" data-color="blue"></button>
                <button class="color-btn green" data-color="green"></button>
                <button class="color-btn yellow" data-color="yellow"></button>
            </div>
        </div>
    </div>

    <!-- Tela de Regras -->
    <div id="rules-screen" class="screen">
        <h2>Regras do UNO</h2>
        <div class="rules-content">
            <h3>Regras B√°sicas</h3>
            <p>O objetivo do UNO √© ser o primeiro jogador a se livrar de todas as cartas.</p>
            <p>Cada jogador recebe 7 cartas no in√≠cio. O restante forma o monte de compras.</p>
            <p>A primeira carta do monte √© virada para iniciar a pilha de descarte.</p>
            <p>Os jogadores devem jogar uma carta que combine com a cor, n√∫mero ou s√≠mbolo da carta no topo da pilha de descarte.</p>
            <p>Se n√£o tiver uma carta compat√≠vel, o jogador deve comprar uma carta do monte. Se a carta comprada for jog√°vel, ela pode ser jogada imediatamente.</p>
            <p>Quando um jogador ficar com apenas uma carta, deve dizer "UNO!". Se n√£o disser e for pego por outro jogador, deve comprar 2 cartas.</p>
            
            <h3>Cartas Especiais</h3>
            <ul>
                <li><strong>Pular (Skip):</strong> O pr√≥ximo jogador perde a vez.</li>
                <li><strong>Inverter (Reverse):</strong> Inverte a dire√ß√£o do jogo.</li>
                <li><strong>+2:</strong> O pr√≥ximo jogador compra 2 cartas e perde a vez.</li>
                <li><strong>Curinga (Wild):</strong> Permite escolher a cor que continuar√° o jogo.</li>
                <li><strong>Curinga +4 (Wild Draw Four):</strong> Permite escolher a cor e o pr√≥ximo jogador compra 4 cartas e perde a vez.</li>
            </ul>
            
            <h3>Cartas Raras e Especiais (Novidade!)</h3>
            <ul>
                <li><strong>Carta 99 (Lend√°ria):</strong> Carta ultra-rara com 0.0000001% de chance de aparecer. Garante vit√≥ria instant√¢nea quando jogada!</li>
                <li><strong>Comando:</strong> For√ßa outro jogador a descartar uma carta de uma cor espec√≠fica.</li>
                <li><strong>Escudo:</strong> Bloqueia o efeito de cartas +2, +4 e +6.</li>
                <li><strong>Troca de M√£os:</strong> Troca sua m√£o com a de outro jogador √† sua escolha.</li>
                <li><strong>Compre At√©:</strong> O pr√≥ximo jogador compra cartas at√© encontrar uma de cor espec√≠fica.</li>
                <li><strong>Turno Duplo:</strong> Permite jogar duas vezes seguidas.</li>
                <li><strong>+6:</strong> O pr√≥ximo jogador compra 6 cartas e perde a vez.</li>
                <li><strong>Pular Todos:</strong> Todos os outros jogadores perdem a vez.</li>
            </ul>
            
            <h3>Modos de Jogo</h3>
            <ul>
                <li><strong>Normal:</strong> Regras padr√£o do UNO.</li>
                <li><strong>Wild:</strong> Mais cartas especiais no baralho.</li>
                <li><strong>No Mercy:</strong> Sem limita√ß√µes para cartas +2 e +4, possibilitando grandes sequ√™ncias.</li>
                <li><strong>Seven-Zero:</strong> A carta 7 faz trocar m√£os com outro jogador e a carta 0 faz todos os jogadores passarem suas m√£os.</li>
                <li><strong>Extreme:</strong> Todas as regras especiais ativadas incluindo cartas exclusivas.</li>
                <li><strong>Speed:</strong> Jogo r√°pido com turnos de 15 segundos.</li>
                <li><strong>Chaos:</strong> Regras imprevis√≠veis que mudam a cada rodada.</li>
                <li><strong>Action Only:</strong> Apenas cartas de a√ß√£o, sem cartas num√©ricas.</li>
                <li><strong>Insane:</strong> Modo insano com cartas poderosas e regras imprevis√≠veis.</li>
                <li><strong>Mirror:</strong> Cada carta jogada afeta todos os jogadores da mesma forma.</li>
                <li><strong>Quick Draw:</strong> Compre uma carta automaticamente a cada turno.</li>
                <li><strong>Challenge:</strong> Cartas de desafio aparecem frequentemente.</li>
            </ul>
            
            <h3>Regras Personaliz√°veis</h3>
            <ul>
                <li><strong>Empilhamento:</strong> Cartas +2 e +4 podem ser empilhadas, acumulando o efeito.</li>
                <li><strong>Jump-In:</strong> Se voc√™ tem uma carta id√™ntica √† do topo da pilha de descarte, pode jog√°-la a qualquer momento.</li>
                <li><strong>For√ßa de Jogo:</strong> Se comprar uma carta jog√°vel, deve jog√°-la imediatamente.</li>
                <li><strong>Troca de Sete:</strong> Ao jogar um 7, troque sua m√£o com outro jogador √† sua escolha.</li>
                <li><strong>Rota√ß√£o de Zero:</strong> Ao jogar um 0, todos passam suas m√£os na dire√ß√£o do jogo.</li>
            </ul>
        </div>
        <button id="back-from-rules" class="secondary-btn">Voltar</button>
    </div>

    <!-- Tela de Op√ß√µes -->
    <div id="options-screen" class="screen">
        <h2>Op√ß√µes</h2>
        <div class="options-container">
            <div class="option-group">
                <h3>Sons</h3>
                <div class="option-item">
                    <label for="sound-effects">Efeitos Sonoros</label>
                    <label class="switch">
                        <input type="checkbox" id="sound-effects" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="background-music">M√∫sica de Fundo</label>
                    <label class="switch">
                        <input type="checkbox" id="background-music" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="option-group">
                <h3>Visual</h3>
                <div class="option-item">
                    <label for="card-animation">Anima√ß√µes de Cartas</label>
                    <label class="switch">
                        <input type="checkbox" id="card-animation" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="dark-mode">Modo Escuro</label>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="legendary-effects">Efeitos Especiais Cartas</label>
                    <label class="switch">
                        <input type="checkbox" id="legendary-effects" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="option-group">
                <h3>Jogabilidade</h3>
                <div class="option-item">
                    <label for="auto-uno">UNO Autom√°tico</label>
                    <label class="switch">
                        <input type="checkbox" id="auto-uno">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="turn-timer">Temporizador de Turnos</label>
                    <label class="switch">
                        <input type="checkbox" id="turn-timer" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="show-playable">Destacar Cartas Jog√°veis</label>
                    <label class="switch">
                        <input type="checkbox" id="show-playable" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="option-item">
                    <label for="random-cards">Distribui√ß√£o Aleat√≥ria</label>
                    <label class="switch">
                        <input type="checkbox" id="random-cards" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <!-- A se√ß√£o de op√ß√µes de banco de dados ser√° adicionada dinamicamente pelo database-error-fix.js -->
        </div>
        <button id="back-from-options" class="secondary-btn">Voltar</button>
    </div>

    <!-- Notifica√ß√£o Toast -->
    <div id="toast" class="toast"></div>

    <!-- Firebase Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-reconnect.js"></script>
    <script src="js/firebase-auth.js"></script>
    <script src="js/firebase-database.js"></script>
    <script src="js/firebase-storage.js"></script>
    <script src="js/firebase-presence.js"></script>
    <script src="js/database-error-fix.js"></script>

    <!-- Scripts de aplica√ß√£o - Ordem importante! -->
    <script src="js/storage.js"></script>
    <script src="js/player.js"></script>
    <script src="js/card-generator.js"></script>
    <script src="js/enhanced-modes.js"></script>
    <script src="js/enhanced-card-renderer.js"></script>
    <script src="js/legendary-card-handler.js"></script>
    <script src="js/room.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/card-renderer.js"></script>
    <script src="js/game-starter.js"></script>
    <script src="js/game-initializer.js"></script>
    <script src="js/ai-player.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
    <script src="js/uno-master-fix.js"></script>
    <script src="js/firebase-direct-fix.js"></script>
    <script src="js/cards-direct-fix.js"></script>
    
    <!-- Script para inicializa√ß√£o -->
    <script>
        console.log("Inicializando aplica√ß√£o UNO em: 2025-04-14 14:48:21");
        console.log("Desenvolvedor: Duduxindev");
        
        // Verificar se todos os scripts foram carregados corretamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado completamente");
            
            // Adicionar pulsa√ß√£o animada ao bot√£o de iniciar jogo
            const pulseButton = document.querySelector('.pulse-button');
            if (pulseButton) {
                setInterval(() => {
                    pulseButton.classList.toggle('pulse');
                }, 1500);
            }
            
            // Inicializar autentica√ß√£o an√¥nima automaticamente
            if (window.FirebaseAuth) {
                FirebaseAuth.signInAnonymously()
                  .then(user => {
                    console.log("‚úÖ Autenticado como:", user.uid);
                    
                    // Inicializar sistema de presen√ßa
                    if (window.FirebasePresence) {
                        FirebasePresence.init(user.uid, Storage.getSession().playerName || "Jogador");
                    }
                  })
                  .catch(error => {
                    console.error("‚ùå Erro de autentica√ß√£o:", error);
                    
                    // Usar autentica√ß√£o local se o Firebase falhar
                    if (window.firebaseFallback) {
                        console.log("üîÑ Usando autentica√ß√£o local");
                        const localUser = {
                            uid: `local-${Math.random().toString(36).substring(2, 15)}`,
                            isAnonymous: true
                        };
                        
                        // Atualizar sess√£o
                        const session = Storage.getSession() || {};
                        session.userId = localUser.uid;
                        Storage.saveSession(session);
                    }
                  });
            }
            
            // Verificar sistemas aprimorados
            setTimeout(function() {
                console.log("üîç Verificando sistemas aprimorados...");
                
                // Verificar se os sistemas est√£o funcionando
                if (!window.cardGenerator) {
                    console.error("‚ö†Ô∏è Gerador de Cartas n√£o carregado corretamente!");
                }
                
                if (!window.enhancedGameModes) {
                    console.error("‚ö†Ô∏è Modos de Jogo Aprimorados n√£o carregados corretamente!");
                }
                
                if (!window.enhancedCardRenderer) {
                    console.error("‚ö†Ô∏è Renderizador de Cartas Aprimorado n√£o carregado corretamente!");
                }
                
                // Substituir sistemas padr√£o por vers√µes aprimoradas, se necess√°rio
                if (window.cardRenderer && window.enhancedCardRenderer) {
                    window.cardRenderer = window.enhancedCardRenderer;
                    console.log("‚úÖ Renderizador de Cartas Aprimorado ativado");
                }
                
                if (window.GameModes && window.enhancedGameModes) {
                    window.GameModes = window.enhancedGameModes;
                    console.log("‚úÖ Modos de Jogo Aprimorados ativados");
                }
                
                // Verificar cartas quando na tela de jogo
                const gameScreen = document.getElementById('game-screen');
                if (gameScreen && gameScreen.classList.contains('active')) {
                    const playerHand = document.getElementById('player-hand');
                    if (!playerHand || playerHand.children.length === 0) {
                        console.log("üÉè For√ßando gera√ß√£o de cartas...");
                        if (typeof forceCardGeneration === 'function') {
                            forceCardGeneration();
                        } else if (window.unoMasterFix && typeof window.unoMasterFix.generatePlayerCards === 'function') {
                            window.unoMasterFix.generatePlayerCards();
                        }
                    }
                }
                
                console.log("üéÆ UNO Game - Vers√£o aprimorada carregada em: 2025-04-14 14:48:21");
            }, 1000);
            
            // Atualizar exibi√ß√£o de modos de jogo na interface
            setTimeout(updateGameModesDisplay, 500);
            
            // Atualizar informa√ß√µes de vers√£o
            updateVersionInfo();
        });
        
        // Fun√ß√£o para atualizar informa√ß√µes de vers√£o
        function updateVersionInfo() {
            const versionInfo = document.querySelector('.version-info');
            
            if (versionInfo) {
                versionInfo.innerHTML = `
                    v2.1.0 - Atualizado em 2025-04-14 14:48:21<br>
                    Desenvolvido por Duduxindev
                `;
            }
            
            // Atualizar t√≠tulo da p√°gina
            document.title = "UNO Online v2.1.0 - Duduxindev";
        }
        
        // Fun√ß√£o para atualizar a exibi√ß√£o de modos de jogo na interface
        function updateGameModesDisplay() {
            // Adicionar novos modos de jogo √† interface
            const modesContainer = document.querySelector('.modes-container');
            if (modesContainer && window.enhancedGameModes) {
                const newModes = ['insane', 'mirror', 'quickDraw', 'challenge'];
                
                newModes.forEach(mode => {
                    const modeInfo = window.enhancedGameModes.getMode(mode);
                    if (modeInfo) {
                        const modeCard = document.createElement('div');
                        modeCard.className = 'mode-card';
                        modeCard.dataset.mode = mode;
                        
                        modeCard.innerHTML = `
                            <div class="mode-icon">${mode.charAt(0).toUpperCase()}</div>
                            <h4>${modeInfo.name}</h4>
                            <p>${modeInfo.description.substring(0, 30)}...</p>
                        `;
                        
                        modeCard.addEventListener('click', function() {
                            // Remover classe "selected" de todos os cart√µes de modo
                            document.querySelectorAll('.mode-card').forEach(card => {
                                card.classList.remove('selected');
                            });
                            
                            // Adicionar classe "selected" ao cart√£o clicado
                            this.classList.add('selected');
                            
                            // Atualizar descri√ß√£o do modo
                            const modeDescription = document.getElementById('mode-description');
                            if (modeDescription) {
                                modeDescription.textContent = modeInfo.description;
                                modeDescription.classList.add('highlight');
                                
                                setTimeout(() => {
                                    modeDescription.classList.remove('highlight');
                                }, 1000);
                            }
                        });
                        
                        modesContainer.appendChild(modeCard);
                    }
                });
                
                console.log("‚úÖ Interface de modos de jogo atualizada com novos modos");
            }
            
            // Fazer o mesmo para os modos de sala online
            const roomModeSelect = document.getElementById('room-mode');
            if (roomModeSelect && window.enhancedGameModes) {
                const newModes = ['insane', 'mirror', 'quickDraw', 'challenge'];
                
                newModes.forEach(mode => {
                    const modeInfo = window.enhancedGameModes.getMode(mode);
                    if (modeInfo) {
                        const option = document.createElement('option');
                        option.value = mode;
                        option.textContent = `${modeInfo.name} - ${modeInfo.description.substring(0, 30)}...`;
                        roomModeSelect.appendChild(option);
                    }
                });
            }
        }
    </script>
    
    <style>
        /* Estilos para bot√£o de iniciar jogo com pulsa√ß√£o */
        .pulse-button {
            position: relative;
            overflow: hidden;
        }
        
        .pulse-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }
        
        .pulse-button.pulse::after {
            animation: pulse-shine 1s forwards;
        }
        
        @keyframes pulse-shine {
            0% { transform: translateX(-100%) rotate(45deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateX(100%) rotate(45deg); opacity: 0; }
        }
        
        /* Destacar modos de jogo */
        .mode-card {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin: 10px;
            width: 120px;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .mode-card.selected {
            background-color: #e8f4fe;
            border: 2px solid #2196F3;
            transform: translateY(-5px);
        }
        
        .modes-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-icon {
            background-color: #2196F3;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 10px;
        }
        
        .mode-card h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }
        
        .mode-card p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
        
        .mode-description {
            background-color: rgba(0,0,0,0.05);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            transition: background-color 0.3s ease;
        }
        
        .mode-description.highlight {
            background-color: rgba(33, 150, 243, 0.1);
        }
        
        /* Efeito de brilho aprimorado para cartas lend√°rias */
        @keyframes legendary-sparkle {
            0% { 
                box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.6);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px 8px rgba(255, 215, 0, 0.8);
                transform: scale(1.02);
            }
            100% { 
                box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.6);
                transform: scale(1);
            }
        }
        
        .legendary-card {
            animation: legendary-sparkle 2s infinite;
        }
        
        /* Estilos para tela de vit√≥ria lend√°ria */
        .victory-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fade-in 1s ease;
        }
        
        .victory-content {
            background: linear-gradient(135deg, #2C3E50 0%, #4B6584 100%);
            border-radius: 15px;
            padding: 40px;
            max-width: 80%;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.6);
            border: 3px solid #FFD700;
            color: white;
        }
        
        .victory-content h1 {
            color: #FFD700;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: pulse-text 2s infinite;
        }
        
        .victory-content p {
            font-size: 1.2rem;
            margin: 15px 0;
        }
        
        .back-to-menu-btn {
            background-color: #FFD700;
            border: none;
            border-radius: 30px;
            padding: 15px 30px;
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
            margin-top: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .back-to-menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.6);
        }
        
        @keyframes pulse-text {
            0% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            100% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
    
    <!-- Corre√ß√µes emergenciais -->
    <script>
    console.log("üîÑ Verifica√ß√£o final do sistema em: 2025-04-14 14:48:21");
    setTimeout(function() {
        // Verificar Firebase
        if (typeof firebase === 'undefined' || typeof FirebaseUtil === 'undefined') {
            console.error("‚ùå Firebase ainda n√£o est√° dispon√≠vel ap√≥s verifica√ß√£o final!");
            
            // Ativar o sistema de fallback para garantir que o jogo funcione
            if (window.firebaseFallback) {
                window.firebaseFallback.patchFirebaseMethods();
                console.log("‚úÖ Sistema de fallback ativado com sucesso");
            } else {
                console.error("‚ùå Sistema de fallback n√£o est√° dispon√≠vel!");
            }
        }
        
        // Verificar sistemas aprimorados de cartas
        if (window.gameInitializer && window.cardGenerator) {
            // Substituir o m√©todo createAndShuffleDeck pelo gerador de cartas aprimorado
            const originalCreateDeck = window.gameInitializer.createAndShuffleDeck;
            window.gameInitializer.createAndShuffleDeck = function(gameMode) {
                console.log("üÉè Usando gerador de cartas aprimorado para o modo:", gameMode);
                
                // Criar cartas usando o gerador aprimorado
                const cards = window.cardGenerator.createDeck(gameMode, true);
                
                // Retornar no formato esperado pelo jogo
                return {
                    cards: cards,
                    drawCard: function() {
                        return this.cards.pop();
                    },
                    addCard: function(card) {
                        this.cards.unshift(card);
                    },
                    cardsLeft: function() {
                        return this.cards.length;
                    }
                };
            };
            
            console.log("‚úÖ Sistema de gera√ß√£o de cartas aprimorado ativado");
        }
        
        // Verificar cartas quando na tela de jogo
        const gameScreen = document.getElementById('game-screen');
        if (gameScreen && gameScreen.classList.contains('active')) {
            const playerHand = document.getElementById('player-hand');
            if (!playerHand || playerHand.children.length === 0) {
                console.log("üÉè Verifica√ß√£o final: gerando cartas manualmente");
                
                // Fun√ß√£o emergencial para gerar cartas
                function emergencyCardGeneration() {
                    const playerHand = document.getElementById('player-hand');
                    if (!playerHand) return;
                    
                    // Limpar m√£o atual
                    playerHand.innerHTML = '';
                    
                    // Cores e valores
                    const colors = ['red', 'blue', 'green', 'yellow'];
                    const values = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'skip', 'reverse', 'draw2'];
                    
                    // Gerar 7 cartas
                    for (let i = 0; i < 7; i++) {
                        const color = colors[Math.floor(Math.random() * colors.length)];
                        const value = values[Math.floor(Math.random() * values.length)];
                        
                        // Criar carta
                        const card = document.createElement('div');
                        card.className = `card ${color}`;
                        card.dataset.id = `emergency-${i}-${Date.now()}`;
                        card.dataset.color = color;
                        card.dataset.value = value;
                        card.dataset.type = isNaN(value) ? 'action' : 'number';
                        
                        // Criar conte√∫do interno da carta
                        card.innerHTML = `
                            <div class="card-inner">
                                <div class="card-corners">
                                    <div class="card-corner top-left">${value}</div>
                                    <div class="card-corner bottom-right">${value}</div>
                                </div>
                                <div class="card-center">${value}</div>
                                <div class="card-reflection"></div>
                            </div>
                        `;
                        
                        // Possibilidade de adicionar carta lend√°ria com chance extremamente baixa
                        if (Math.random() < 0.0000001) {
                            const legendaryCard = document.createElement('div');
                            legendaryCard.className = 'card gold legendary-card';
                            legendaryCard.dataset.id = `legendary-99-${Date.now()}`;
                            legendaryCard.dataset.color = 'gold';
                            legendaryCard.dataset.value = '99';
                            legendaryCard.dataset.type = 'legendary';
                            legendaryCard.dataset.rarity = 'legendary';
                            
                            legendaryCard.innerHTML = `
                                <div class="card-inner">
                                    <div class="legendary-glow"></div>
                                    <div class="card-corners">
                                        <div class="card-corner top-left">99</div>
                                        <div class="card-corner bottom-right">99</div>
                                    </div>
                                    <div class="card-center legendary-symbol">99</div>
                                    <div class="rarity-indicator">LEND√ÅRIA</div>
                                    <div class="legendary-description">Carta lend√°ria que garante uma vit√≥ria instant√¢nea.</div>
                                    <div class="card-reflection legendary-reflection"></div>
                                </div>
                            `;
                            
                            playerHand.appendChild(legendaryCard);
                        } else {
                            playerHand.appendChild(card);
                        }
                    }
                    
                    // Atualizar contador
                    const cardCounter = document.getElementById('card-count');
                    if (cardCounter) {
                        cardCounter.textContent = '7 cartas';
                    }
                }
                
                emergencyCardGeneration();
            }
        }
        
        console.log("‚úÖ Verifica√ß√£o final conclu√≠da em: 2025-04-14 14:48:21");
    }, 3000);
    </script>
</body>
</html>